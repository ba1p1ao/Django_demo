# 班级管理功能实现文档

## 版本信息

- **版本**: v1.0
- **发布日期**: 2026-01-02
- **开发者**: iFlow CLI
- **状态**: 前端已完成，待后端实现

---

## 功能概述

班级管理功能为在线考试系统增加了班级组织能力，使教师可以更好地管理学生、发布考试和查看成绩。该功能包括班级创建、成员管理、成绩统计等多个模块。

---

## 功能清单

### 1. 班级管理模块
- ✅ 班级列表查询（支持搜索、分页）
- ✅ 班级创建（管理员）
- ✅ 班级信息编辑（管理员）
- ✅ 班级删除（管理员）
- ✅ 班级状态管理（启用/禁用）
- ✅ 班级详情查看

### 2. 班级成员管理模块
- ✅ 班级成员列表查看
- ✅ 添加学生到班级
- ✅ 从班级移除学生
- ✅ 查看可选学生列表
- ✅ 班级统计信息展示

### 3. 集成功能
- ✅ 用户管理页面添加班级筛选
- ✅ 试卷发布页面添加班级选择
- ✅ 成绩排名页面添加班级筛选
- ✅ 侧边栏菜单添加班级管理入口

---

## 文件结构

### 新增文件

```
exam-frontend/
├── src/
│   ├── api/
│   │   └── class.js                          # 班级管理API接口
│   ├── components/
│   │   └── ClassMemberDialog.vue             # 班级成员管理对话框组件
│   └── views/
│       └── ClassManagement.vue              # 班级管理主页面
```

### 修改文件

```
exam-frontend/
├── src/
│   ├── router/
│   │   └── index.js                          # 添加班级管理路由
│   └── views/
│       ├── Layout.vue                        # 添加班级管理菜单入口
│       ├── Users.vue                         # 添加班级筛选功能
│       ├── ExamForm.vue                      # 添加班级选择功能
│       └── Ranking.vue                       # 添加班级筛选功能
```

---

## API接口说明

### 班级管理接口

| 接口名称 | 方法 | 路径 | 说明 |
|---------|------|------|------|
| 获取班级列表 | GET | `/class/list` | 支持分页和筛选 |
| 获取班级详情 | GET | `/class/{id}` | 获取单个班级详细信息 |
| 创建班级 | POST | `/class/create` | 管理员专用 |
| 更新班级 | PUT | `/class/{id}` | 管理员专用 |
| 删除班级 | DELETE | `/class/{id}` | 管理员专用 |
| 更新班级状态 | PUT | `/class/{id}/status` | 管理员专用 |

### 班级成员管理接口

| 接口名称 | 方法 | 路径 | 说明 |
|---------|------|------|------|
| 获取班级成员 | GET | `/class/{id}/members` | 支持分页和角色筛选 |
| 添加成员 | POST | `/class/{id}/members/add` | 批量添加学生 |
| 移除成员 | DELETE | `/class/{id}/members/remove` | 批量移除学生 |
| 获取可选学生 | GET | `/class/{id}/available-students` | 未加入班级的学生 |

### 班级统计接口

| 接口名称 | 方法 | 路径 | 说明 |
|---------|------|------|------|
| 班级成绩统计 | GET | `/class/{id}/statistics` | 学生人数、平均分、及格率等 |
| 班级考试排名 | GET | `/class/{id}/exam-ranking` | 按班级查看排名 |
| 班级成绩趋势 | GET | `/class/{id}/score-trend` | 班级成绩变化趋势 |

### 辅助接口

| 接口名称 | 方法 | 路径 | 说明 |
|---------|------|------|------|
| 教师班级列表 | GET | `/teacher/classes` | 教师管理的班级 |
| 学生班级信息 | GET | `/student/class` | 学生所在班级 |
| 班级选项列表 | GET | `/class/options` | 用于下拉选择 |

---

## 页面功能详解

### 1. 班级管理页面 (`ClassManagement.vue`)

#### 功能特性
- **班级列表展示**：显示班级名称、年级、班主任、学生人数、状态等信息
- **搜索筛选**：支持按班级名称、年级、状态进行筛选
- **创建班级**：管理员可以创建新班级，设置班级名称、年级、班主任
- **编辑班级**：管理员可以修改班级信息
- **状态管理**：管理员可以启用或禁用班级
- **删除班级**：管理员可以删除班级（需确认）
- **成员管理**：点击"成员管理"按钮打开成员管理对话框

#### 权限控制
- **管理员**：可以创建、编辑、删除班级，管理所有班级
- **教师**：只能查看班级列表和管理自己负责的班级

---

### 2. 班级成员管理组件 (`ClassMemberDialog.vue`)

#### 功能特性
- **成员列表**：显示班级所有成员（学生和教师）
- **角色筛选**：可以按角色筛选成员
- **添加成员**：从可选学生列表中选择并添加到班级
- **移除成员**：从班级中移除成员（需确认）
- **班级统计**：显示班级学生人数、考试次数、平均分、及格率等
- **成绩分布**：显示各分数段的学生人数分布

#### 组件结构
```vue
<el-dialog>
  <el-tabs>
    <el-tab-pane label="班级成员">
      <!-- 成员列表和操作 -->
    </el-tab-pane>
    <el-tab-pane label="班级统计">
      <!-- 统计信息和图表 -->
    </el-tab-pane>
  </el-tabs>
</el-dialog>
```

---

### 3. 用户管理页面增强 (`Users.vue`)

#### 新增功能
- **班级筛选**：在搜索表单中添加班级选择下拉框
- **班级显示**：在用户列表中添加班级列，显示用户所属班级
- **班级数据**：用户列表返回数据包含 `class_name` 字段

#### 使用场景
- 管理员可以按班级查看用户
- 可以快速查找某个班级的所有学生
- 便于批量管理班级成员

---

### 4. 试卷发布页面增强 (`ExamForm.vue`)

#### 新增功能
- **班级选择**：在创建/编辑试卷时可以选择指定班级
- **多选支持**：支持选择多个班级
- **全局发布**：不选择班级时，所有学生都可以看到考试

#### 使用场景
- 教师可以针对特定班级发布考试
- 可以实现分班级考试
- 支持跨班级联合考试

---

### 5. 成绩排名页面增强 (`Ranking.vue`)

#### 新增功能
- **班级筛选**：教师和管理员可以按班级查看排名
- **班级选择**：在考试排名视图中添加班级选择下拉框
- **权限控制**：学生无法使用班级筛选功能

#### 使用场景
- 教师可以查看自己班级的成绩排名
- 管理员可以查看任意班级的排名
- 便于班级间成绩对比

---

## 数据库设计建议

### 1. class 表（班级表）

```sql
CREATE TABLE `class` (
  `id` INT PRIMARY KEY AUTO_INCREMENT,
  `name` VARCHAR(100) NOT NULL COMMENT '班级名称',
  `grade` VARCHAR(50) NULL COMMENT '年级',
  `head_teacher_id` INT NULL COMMENT '班主任ID',
  `status` INT DEFAULT 1 COMMENT '状态：1正常 0禁用',
  `create_time` DATETIME DEFAULT CURRENT_TIMESTAMP,
  `update_time` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`head_teacher_id`) REFERENCES `user`(`id`),
  UNIQUE KEY `uk_name` (`name`)
) COMMENT='班级表';
```

### 2. user_class 表（用户班级关联表）

```sql
CREATE TABLE `user_class` (
  `id` INT PRIMARY KEY AUTO_INCREMENT,
  `user_id` INT NOT NULL COMMENT '用户ID',
  `class_id` INT NOT NULL COMMENT '班级ID',
  `join_time` DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '加入时间',
  FOREIGN KEY (`user_id`) REFERENCES `user`(`id`),
  FOREIGN KEY (`class_id`) REFERENCES `class`(`id`),
  UNIQUE KEY `uk_user_class` (`user_id`, `class_id`)
) COMMENT='用户班级关联表';
```

### 3. user 表需要添加字段

```sql
ALTER TABLE `user` ADD COLUMN `class_id` INT NULL COMMENT '所属班级ID' AFTER `role`;
ALTER TABLE `user` ADD FOREIGN KEY (`class_id`) REFERENCES `class`(`id`);
```

### 4. exam 表需要添加字段（可选）

```sql
ALTER TABLE `exam` ADD COLUMN `class_ids` TEXT NULL COMMENT '指定班级ID列表（JSON）' AFTER `status`;
```

---

## 路由配置

### 新增路由

```javascript
{
  path: '/class-management',
  name: 'ClassManagement',
  component: () => import('@/views/ClassManagement.vue'),
  meta: { title: '班级管理', roles: ['admin', 'teacher'] }
}
```

### 路由守卫

- 班级管理页面仅管理员和教师可访问
- 学生无法访问班级管理页面

---

## 菜单配置

### 侧边栏菜单

**管理员和教师菜单中新增：**
```
班级管理
```

**菜单位置：**
- 首页
- 题库管理
- 试卷管理
- **班级管理** ← 新增
- 用户管理（管理员）
- 考试记录
- 成绩排名
- 个人中心

---

## 权限控制

### 角色权限矩阵

| 功能 | 管理员 | 教师 | 学生 |
|-----|--------|------|------|
| 查看班级列表 | ✅ | ✅ | ❌ |
| 创建班级 | ✅ | ❌ | ❌ |
| 编辑班级 | ✅ | ❌ | ❌ |
| 删除班级 | ✅ | ❌ | ❌ |
| 管理班级成员 | ✅ | ✅（仅自己的班级） | ❌ |
| 查看班级统计 | ✅ | ✅（仅自己的班级） | ❌ |
| 按班级筛选用户 | ✅ | ✅ | ❌ |
| 按班级发布考试 | ✅ | ✅ | ❌ |
| 按班级查看排名 | ✅ | ✅ | ❌ |
| 查看自己班级信息 | ✅ | ✅ | ✅ |

---

## 使用指南

### 1. 创建班级（管理员）

1. 登录管理员账号
2. 进入"班级管理"页面
3. 点击"创建班级"按钮
4. 填写班级信息：
   - 班级名称（必填）
   - 年级（必填）
   - 班主任（可选）
5. 点击"确定"保存

### 2. 管理班级成员

1. 进入"班级管理"页面
2. 找到要管理的班级
3. 点击"成员管理"按钮
4. 在"班级成员"标签页中：
   - 查看当前成员列表
   - 点击"添加成员"按钮添加学生
   - 点击"移除"按钮移除成员
5. 在"班级统计"标签页中查看统计信息

### 3. 发布考试到指定班级

1. 进入"试卷管理"页面
2. 点击"创建试卷"或编辑已有试卷
3. 填写试卷基本信息
4. 在"指定班级"选项中选择目标班级
5. 保存试卷

### 4. 查看班级成绩排名

1. 进入"成绩排名"页面
2. 选择要查看的考试
3. 在"选择班级"下拉框中选择目标班级
4. 查看该班级的成绩排名

---

## 后端实现要点

### 1. 必须实现的接口

#### 高优先级
- `GET /class/list` - 班级列表
- `GET /class/{id}` - 班级详情
- `POST /class/create` - 创建班级
- `PUT /class/{id}` - 更新班级
- `DELETE /class/{id}` - 删除班级
- `PUT /class/{id}/status` - 更新状态
- `GET /class/{id}/members` - 班级成员
- `POST /class/{id}/members/add` - 添加成员
- `DELETE /class/{id}/members/remove` - 移除成员
- `GET /class/{id}/available-students` - 可选学生
- `GET /class/options` - 班级选项

#### 中优先级
- `GET /class/{id}/statistics` - 班级统计
- `GET /teacher/classes` - 教师班级
- `GET /student/class` - 学生班级

#### 低优先级
- `GET /class/{id}/exam-ranking` - 班级排名
- `GET /class/{id}/score-trend` - 班级趋势

### 2. 数据验证

- 班级名称不能重复
- 一个学生只能属于一个班级
- 删除班级前检查是否有学生
- 班主任必须是教师角色

### 3. 权限验证

- 管理员可以管理所有班级
- 教师只能管理自己负责的班级
- 学生只能查看自己所在班级

### 4. 数据返回格式

#### 班级列表返回
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "list": [
      {
        "id": 1,
        "name": "三年二班",
        "grade": "三年级",
        "head_teacher_id": 2,
        "head_teacher_name": "张老师",
        "student_count": 45,
        "status": 1,
        "create_time": "2024-01-01 00:00:00"
      }
    ],
    "total": 20,
    "page": 1,
    "size": 10
  }
}
```

#### 用户列表返回（需包含班级信息）
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "list": [
      {
        "id": 1,
        "username": "student1",
        "nickname": "张三",
        "role": "student",
        "class_id": 1,
        "class_name": "三年二班",
        "status": 1,
        "create_time": "2024-01-01 00:00:00"
      }
    ],
    "total": 100,
    "page": 1,
    "size": 10
  }
}
```

---

## 测试建议

### 1. 功能测试

#### 班级管理
- [ ] 创建班级成功
- [ ] 编辑班级信息成功
- [ ] 删除班级成功
- [ ] 启用/禁用班级成功
- [ ] 班级名称重复时提示错误

#### 成员管理
- [ ] 添加单个学生成功
- [ ] 批量添加学生成功
- [ ] 移除学生成功
- [ ] 查看成员列表正确
- [ ] 搜索可选学生正确

#### 集成功能
- [ ] 用户管理页面班级筛选正常
- [ ] 试卷发布班级选择正常
- [ ] 成绩排名班级筛选正常

### 2. 权限测试

- [ ] 管理员可以创建班级
- [ ] 教师无法创建班级
- [ ] 学生无法访问班级管理页面
- [ ] 教师只能管理自己的班级

### 3. 边界测试

- [ ] 班级名称为空时提示错误
- [ ] 删除有学生的班级时提示警告
- [ ] 添加已存在的学生时提示错误
- [ ] 班级成员为0时显示正确

---

## 常见问题

### Q1: 如何批量导入学生到班级？
A: 当前版本支持逐个添加学生，批量导入功能可以在后续版本中实现。

### Q2: 一个学生可以属于多个班级吗？
A: 当前设计是一个学生只能属于一个班级，如需调整可以修改数据库设计。

### Q3: 如何实现跨班级考试？
A: 在发布考试时选择多个班级即可实现跨班级考试。

### Q4: 删除班级后班级成员会怎样？
A: 删除班级后，班级成员的 `class_id` 字段会被清空，成员不会被删除。

### Q5: 如何查看班级的历史成绩？
A: 可以在"班级成员管理"对话框的"班级统计"标签页中查看统计信息。

---

## 后续优化建议

### 1. 功能增强
- [ ] 批量导入学生到班级
- [ ] 班级模板功能
- [ ] 班级间成绩对比
- [ ] 班级活动管理
- [ ] 班级公告功能

### 2. 性能优化
- [ ] 班级列表缓存
- [ ] 成绩统计缓存
- [ ] 分页查询优化
- [ ] 添加数据库索引

### 3. 用户体验
- [ ] 添加班级头像
- [ ] 班级介绍页面
- [ ] 班级相册功能
- [ ] 班级日历功能

### 4. 数据分析
- [ ] 班级成绩趋势分析
- [ ] 班级学习进度跟踪
- [ ] 班级知识点掌握度
- [ ] 班级学习报告

---

## 技术栈

- **前端框架**: Vue 3.5.24
- **UI组件**: Element Plus 2.13.0
- **状态管理**: Pinia 3.0.4
- **路由管理**: Vue Router 4.6.4
- **HTTP客户端**: Axios 1.13.2

---

## 联系方式

如有问题或建议，请联系开发团队。

---

## 更新日志

### v1.0 (2026-01-02)
- ✅ 完成班级管理功能前端实现
- ✅ 完成班级成员管理组件
- ✅ 完成用户管理页面集成
- ✅ 完成试卷发布页面集成
- ✅ 完成成绩排名页面集成
- ✅ 完成路由和菜单配置
- ✅ 完成API接口设计
- ⏳ 等待后端实现